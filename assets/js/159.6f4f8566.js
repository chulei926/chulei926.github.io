(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{521:function(s,a,t){"use strict";t.r(a);var n=t(22),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"dockerfile各种构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile各种构建"}},[s._v("#")]),s._v(" Dockerfile各种构建")]),s._v(" "),t("h2",{attrs:{id:"dockerfile-构建-centos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建-centos"}},[s._v("#")]),s._v(" Dockerfile 构建 centos")]),s._v(" "),t("h3",{attrs:{id:"dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM centos:7\nMAINTAINER leichu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chulei926@126.com"')]),s._v("\n\nRUN yum -y -q "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools\nRUN yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" vim*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"build-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-sh"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\ndocker build -t leichu-centos "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"修改tag-推送到-私服"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改tag-推送到-私服"}},[s._v("#")]),s._v(" 修改tag，推送到 私服")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ docker tag leichu-centos "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-centos\n$ docker push "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-centos\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"dockerfile-构建-jdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建-jdk"}},[s._v("#")]),s._v(" Dockerfile 构建 jdk")]),s._v(" "),t("h3",{attrs:{id:"dockerfile-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-2"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-centos\nMAINTAINER leichu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chulei926@126.com"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 通过 yum 方式安装 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## yum 命令参数 ： -y（当安装过程提示选择全部为"yes"），-q（不显示安装的过程）')]),s._v("\nRUN yum -y -q "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" java-1.8.0-openjdk\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 通过 下载安装包 方式安装 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ADD jdk-8u231-linux-x64.tar.gz /usr/local/java/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ENV JAVA_HOME /usr/local/java/jdk1.8.0_231")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ENV CLASSPATH .:${JAVA_HOME}/lib:${JRE_HOME}/lib")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ENV PATH ${JAVA_HOME}/bin:$PATH")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"build-sh-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-sh-2"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\ndocker build -t jdk8 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"build4openjdk-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build4openjdk-sh"}},[s._v("#")]),s._v(" build4openjdk.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\ndocker build -t openjdk8 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"修改tag-推送到-私服-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改tag-推送到-私服-2"}},[s._v("#")]),s._v(" 修改tag，推送到 私服")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker tag jdk8 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-jdk\ndocker push "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-jdk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"dockerfile-构建-tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建-tomcat"}},[s._v("#")]),s._v(" Dockerfile 构建 tomcat")]),s._v(" "),t("h3",{attrs:{id:"dockerfile-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-3"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.4:5000/leichu-jdk\nMAINTAINER leichu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chulei926@126.com"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 通过 下载安装包 方式安装 ")]),s._v("\nADD apache-tomcat-8.5.49.tar.gz /\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" apache-tomcat-8.5.49 tomcat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#!/bin/bash"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /bin/startTomcat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh /tomcat/bin/catalina.sh run"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /bin/startTomcat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /bin/startTomcat\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\nWORKDIR /tomcat\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"startTomcat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"build-sh-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-sh-3"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\ndocker build -t "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.4:5000/leichu-tomcat "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"修改tag-推送到-私服-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改tag-推送到-私服-3"}},[s._v("#")]),s._v(" 修改tag，推送到 私服")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ docker push "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.4:5000/leichu-tomcat\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"启动测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动测试"}},[s._v("#")]),s._v(" 启动测试")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -p 9999:8080 将docker内部的8080端口映射成外部的9999端口")]),s._v("\n$ docker run -itd -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v(":8080  9a7475d438ee \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 浏览器访问 http://180.76.183.170:9999/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"dockerfile-构建-elasticsearch-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建-elasticsearch-集群"}},[s._v("#")]),s._v(" Dockerfile 构建 elasticsearch 集群")]),s._v(" "),t("p",[t("strong",[s._v("基于 安装包 构建")])]),s._v(" "),t("h3",{attrs:{id:"dockerfile-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-4"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-jdk\nMAINTAINER leichu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chulei926@126.com"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## elasticsearch 默认不能使用root用户启动")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" -r elasticsearch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -r -g elasticsearch elasticsearch\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 创建 data 和 log 目录")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mnt/elasticsearch/data\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mnt/elasticsearch/logs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## data 和 log 目录的所有者改为 elasticsearch 用户")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R elasticsearch. /mnt/*\n\nADD elasticsearch-7.5.0-linux-x86_64.tar.gz /elasticsearch\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" elasticsearch-7.5.0 elasticsearch \nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /elasticsearch/bin/*\n\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /elasticsearch/bin/elasticsearch /usr/bin/elasticsearch\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## /elasticsearch 目录的所有者改为 elasticsearch 用户")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R elasticsearch. /elasticsearch\n\nVOLUME /mnt/elasticsearch\n\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n\nENV ES_HOME /elasticsearch\nENV "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ES_HOME}")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n\nWORKDIR /elasticsearch\n\n"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" elasticsearch\nRUN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h3",{attrs:{id:"build-sh-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-sh-4"}},[s._v("#")]),s._v(" build.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\ndocker build -t "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/leichu-es "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"启动测试-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动测试-2"}},[s._v("#")]),s._v(" 启动测试")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 因为测试机内存太小，故上面执行 build.sh 时，会抛出 Cannot allocate memory 错误！")]),s._v("\ndocker run --name es1 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9201")]),s._v(":9200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9301")]),s._v(":9300 -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('/start/node1/elasticsearch.yml"')]),s._v(":/elasticsearch/config/elasticsearch.yml -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node1/data"')]),s._v(":/elasticsearch/data/ -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node1/logs"')]),s._v(":/elasticsearch/logs/ --ulimit "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nofile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(":131072 -d elasticsearch\ndocker run --name es2 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9202")]),s._v(":9200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9302")]),s._v(":9300 -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('/start/node2/elasticsearch.yml"')]),s._v(":/elasticsearch/config/elasticsearch.yml -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node2/data"')]),s._v(":/elasticsearch/data/ -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node2/logs"')]),s._v(":/elasticsearch/logs/ --ulimit "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nofile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(":131072 -d elasticsearch\ndocker run --name es3 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9203")]),s._v(":9200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9303")]),s._v(":9300 -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('/start/node3/elasticsearch.yml"')]),s._v(":/elasticsearch/config/elasticsearch.yml -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node3/data"')]),s._v(":/elasticsearch/data/ -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/node3/logs"')]),s._v(":/elasticsearch/logs/ --ulimit "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nofile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(":131072 -d elasticsearch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("基于 docker-compose 构建")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## TODO  内存不够，暂不考虑，docker-compose.yml 参考官网")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"docker-构建-puppeteer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-构建-puppeteer"}},[s._v("#")]),s._v(" Docker 构建 puppeteer")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://pan.baidu.com/s/1V81AJX2kpfSMQ9581kDKEg",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://pan.baidu.com/s/1V81AJX2kpfSMQ9581kDKEg"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("提取码：ppte")]),s._v(" "),t("h3",{attrs:{id:"dockerfile-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-5"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("FROM centos:7\nMAINTAINER leichu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chulei926@126.com"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置系统编码（处理中文乱码问题）")]),s._v("\nCOPY fonts/* /usr/share/fonts/\nRUN yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mkfontscale fontconfig\nRUN mkfontscale\nRUN mkfontdir\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 node")]),s._v("\nADD node.tar.gz /usr/local\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -fs /usr/local/node/bin/node /usr/bin/node\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -fs /usr/local/node/bin/npm /usr/bin/npm\nENV NODE_HOME /usr/local/node\nENV "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${NODE_HOME}")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 PM2")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pm2@latest -g\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -fs /usr/local/node/bin/pm2 /usr/bin/pm2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 puppeteer")]),s._v("\nRUN yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y libatk* libxkbcommon* libgtk*\nADD ppte.tar.gz /usr/local\n\nWORKDIR /usr/local/ppte\n\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#!/bin/bash"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /bin/startPte "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./start.sh && sh"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /bin/startPte\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /bin/startPte\n\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"startPte"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("h3",{attrs:{id:"构建-推送-运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建-推送-运行"}},[s._v("#")]),s._v(" 构建&推送&运行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build -t "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".195.95:5000/ppte "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);