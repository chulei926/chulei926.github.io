(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{384:function(t,e,s){"use strict";s.r(e);var a=s(22),i=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"sso-cas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sso-cas"}},[t._v("#")]),t._v(" SSO & CAS")]),t._v(" "),s("h2",{attrs:{id:"sso"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sso"}},[t._v("#")]),t._v(" SSO")]),t._v(" "),s("p",[t._v("SSO英文全称Single Sign On，单点登录。SSO是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。CAS是一种基于http协议的B/S应用系统单点登录实现方案，认识CAS之前首先要熟悉http协议、Session 与 Cookie 等Web开发基本知识。")]),t._v(" "),s("h3",{attrs:{id:"http"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[t._v("#")]),t._v(" HTTP")]),t._v(" "),s("p",[t._v("HTTP是一个客户端和服务器端请求和应答的标准，我们全后端开发对接的Rest接口就是基于http协议。http协议包含http请求消息（HttpRequest）和http应答消息（HttpResponse）两部分。")]),t._v(" "),s("ul",[s("li",[t._v("理解http协议是无状态协议的含义")]),t._v(" "),s("li",[t._v("熟记常见的http协议状态码，其中302等与cas相关")]),t._v(" "),s("li",[t._v("熟记常见的http请求头，其中Cookie等与cas相关")]),t._v(" "),s("li",[t._v("熟记常见的http应答头，其中Set-Cookie、Location等与cas相关")])]),t._v(" "),s("h3",{attrs:{id:"session-与-cookie-会话机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session-与-cookie-会话机制"}},[t._v("#")]),t._v(" Session 与 Cookie 会话机制")]),t._v(" "),s("p",[t._v("HTTP 本身是无状态的，但是有时候我们需要HTTP请求保持状态，我们引入 Session 与 Cookie 。")]),t._v(" "),s("p",[t._v("Session 用在服务端，用于存储当前所有客户端要保存的状态值，并为每一个客户端生成一个唯一编码，然后通过HTTP响应头 Set-Cookie 将这个值发送给客户端。")]),t._v(" "),s("p",[t._v("Cookie 用在客户端，用于记录后端发送过来的唯一编码，该编码与服务端上的对用的状态值对应，在下一次请求的时候通过 HTTP 请求头 Cookie 带上这个编码，服务端就能根据这个编码获取该客户端之前记录的所有状态值。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/SessionCookie.png",alt:"SessionCookie"}})]),t._v(" "),s("h2",{attrs:{id:"cas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cas"}},[t._v("#")]),t._v(" CAS")]),t._v(" "),s("p",[t._v("CAS （ Central Authentication Service ） 是 Yale 大学发起的一个企业级的、开源的项目，旨在为 Web 应用系统提供一种可靠的单点登录解决方法（属于 Web SSO ）。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://apereo.github.io/cas/4.2.x/planning/Architecture.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAS Architecture"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/cas_architecture.png",alt:"cas_architecture"}})]),t._v(" "),s("h2",{attrs:{id:"原理-两次前端跳转、一次后端验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-两次前端跳转、一次后端验证"}},[t._v("#")]),t._v(" 原理：两次前端跳转、一次后端验证")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/cas%E6%B5%81%E7%A8%8B.png",alt:"cas流程"}})]),t._v(" "),s("p",[t._v("下面结合浏览器请求分析上图：")]),t._v(" "),s("ol",[s("li",[t._v("用户在浏览器中输入要访问的应用客户端地址 "),s("code",[t._v("https://app1.leichu.top/app1/index")]),t._v("。")]),t._v(" "),s("li",[t._v("由于客户端的 "),s("code",[t._v("web.xml")]),t._v(" 中配置了 CAS 登录的过滤器 "),s("code",[t._v("AuthenticationFilter")]),t._v("，判断此时用户未登录，所以返回 "),s("code",[t._v("302")]),t._v(" 状态码，重定向到 CAS 认证服务器，此时，浏览器跳转到 CAS 服务器的登录界面 "),s("code",[t._v("https://sso.leichu.top/cas/login?service=https://app1.leichu.top/app1/index")]),t._v("，并且，在请求路径后面追加 "),s("code",[t._v("service=https://app1.leichu.top/app1/index")]),t._v(" 作为 queryString 。"),s("strong",[t._v("这里是第一次前端跳转")]),t._v("。")]),t._v(" "),s("li",[t._v("用户再登录界面输入用户名密码，点击提交，此时 CAS 认证服务器进行登录认证，如果登录成功，返回 "),s("code",[t._v("302")]),t._v(" 状态码，并且往Cookie中设置了一个"),s("code",[t._v("TGC")]),t._v("："),s("code",[t._v("Set-Cookie: TGC=xxxxxx")]),t._v("。根据"),s("code",[t._v("service")]),t._v("参数，再次重定向回到客户端，此时的重定向地址后追加了一个"),s("code",[t._v("ticket")]),t._v("参数："),s("code",[t._v("https://app1.leichu.top/app1/index?ticket=ST-1-T2rLRl8YqFKq13sulGt-EM4S3LEleichu")]),t._v("。"),s("strong",[t._v("这里是第二次前端跳转")])]),t._v(" "),s("li",[t._v("到这里已经认证完成回到了客户端，和第二步一样， 由于客户端的 "),s("code",[t._v("web.xml")]),t._v(" 中配置了 CAS "),s("code",[t._v("ticket校验")]),t._v("的过滤器"),s("code",[t._v("Cas30ProxyReceivingTicketValidationFilter")]),t._v("，这里客户端会带着 "),s("code",[t._v("service")]),t._v(" 和 前一步的 "),s("code",[t._v("ticket")]),t._v(" 去 CAS 服务器进行校验，如果通过，则当前客户端的整个登录认证流程完成。这里的 ticket 校验，就是"),s("strong",[t._v("一次后端验证")]),t._v("。")])]),t._v(" "),s("p",[t._v("下面是浏览器具体的请求过程截图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/step1.png",alt:"step1"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/step2.png",alt:"step2"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/step3.1.png",alt:"step3.1"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/step3.2.png",alt:"step3.2"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/cas/step4.png",alt:"step4"}})])])}),[],!1,null,null,null);e.default=i.exports}}]);