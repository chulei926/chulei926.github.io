(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{499:function(s,a,e){"use strict";e.r(a);var t=e(22),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"journalctl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#journalctl"}},[s._v("#")]),s._v(" journalctl")]),s._v(" "),e("h2",{attrs:{id:"_1-基础用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础用法"}},[s._v("#")]),s._v(" 1. 基础用法")]),s._v(" "),e("h3",{attrs:{id:"_1-1-查看所有日志-默认显示本次启动的所有日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查看所有日志-默认显示本次启动的所有日志"}},[s._v("#")]),s._v(" 1.1 查看所有日志(默认显示本次启动的所有日志)")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看本次启动的所有日志也可以使用")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -b\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_1-2-查看内核日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-查看内核日志"}},[s._v("#")]),s._v(" 1.2 查看内核日志")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -k\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_1-3-查看指定时间的日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-查看指定时间的日志"}},[s._v("#")]),s._v(" 1.3 查看指定时间的日志")]),s._v(" "),e("p",[s._v("通过--since和--until选项，可以过滤任意时间限制，显示指定条件之前、之后或之间的日志。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl --since"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-09-21 10:21:00"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查询一个时间段范围内的日志。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl --since"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-09-21 10:21:00"')]),s._v(" --until"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-09-21 10:22:00"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_1-4-根据不同的主题进行过滤筛选"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-根据不同的主题进行过滤筛选"}},[s._v("#")]),s._v(" 1.4 根据不同的主题进行过滤筛选")]),s._v(" "),e("h5",{attrs:{id:"根据服务筛选"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#根据服务筛选"}},[s._v("#")]),s._v(" 根据服务筛选")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -u kubelet.service\n$ journalctl -u kubelet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"根据进程id查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#根据进程id查询"}},[s._v("#")]),s._v(" 根据进程ID查询")]),s._v(" "),e("p",[s._v("如果进程使用了systemd托管日志，则可以通过以下命令查找进程对应的日志。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_PID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Systemd journal 有很多可以用来过滤的字段，可以通过 man systemd.journal-fields 查看所有可以用来过滤的字段。对于用来筛选的字段，可以使用-F参数来查看所有可以用来过滤的值，例如journalctl -F _PID。")]),s._v(" "),e("h5",{attrs:{id:"按优先级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#按优先级"}},[s._v("#")]),s._v(" 按优先级")]),s._v(" "),e("p",[s._v("操作系统提供了从0 (emerg) 到 7 (debug) 一共7个级别的日志，可以配合-p参数分别查看对应级别的日志。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" -u kubelet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("7个级别的含义为")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("0: emerg\n1: alert\n2: crit\n3: err\n4: warning\n5: notice\n6: info\n7: debug\n")])])]),e("h3",{attrs:{id:"_1-5-调整显示输出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-调整显示输出"}},[s._v("#")]),s._v(" 1.5 调整显示输出")]),s._v(" "),e("p",[s._v("默认情况，journal输出进入分页模式，用户可以在终端上调整显示的内容，如果要不需要分页，需要加上--no-pager参数。")]),s._v(" "),e("p",[s._v("以Json格式输出")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" --no-pager -o json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("通过-o参数，可以设置为json格式输出，这对于其他接收json格式的日志分析工具非常友好。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" --no-pager -o json-pretty\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用json-pretty则对于管理员查看日志非常易读。")]),s._v(" "),e("p",[s._v("支持的各种格式如下：")]),s._v(" "),e("ul",[e("li",[s._v("cat: 只显示信息字段本身。")]),s._v(" "),e("li",[s._v("export: 适合传输或备份的二进制格式。")]),s._v(" "),e("li",[s._v("json: 标准JSON，每行一个条目。")]),s._v(" "),e("li",[s._v("json-pretty: JSON格式，适合人类阅读习惯。")]),s._v(" "),e("li",[s._v("json-sse: JSON格式，经过打包以兼容server-sent事件。")]),s._v(" "),e("li",[s._v("short: 默认syslog类输出格式。")]),s._v(" "),e("li",[s._v("short-iso: 默认格式，强调显示ISO 8601挂钟时间戳。")]),s._v(" "),e("li",[s._v("short-monotonic: 默认格式，提供普通时间戳。")]),s._v(" "),e("li",[s._v("short-precise: 默认格式，提供微秒级精度。")]),s._v(" "),e("li",[s._v("verbose: 显示该条目的全部可用journal字段，包括通常被内部隐藏的字段。")])]),s._v(" "),e("h3",{attrs:{id:"_1-6-活动日志跟踪"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-活动日志跟踪"}},[s._v("#")]),s._v(" 1.6 活动日志跟踪")]),s._v(" "),e("p",[s._v("journalctl也支持类似tail的功能，如通过-n参数指定显示最近的多少行，默认为10行，通过-f参数持续监控日志输出。")]),s._v(" "),e("h2",{attrs:{id:"_2-维护"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-维护"}},[s._v("#")]),s._v(" 2. 维护")]),s._v(" "),e("h3",{attrs:{id:"_2-1-查看日志占用的磁盘空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-查看日志占用的磁盘空间"}},[s._v("#")]),s._v(" 2.1 查看日志占用的磁盘空间")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl --disk-usage\nArchived and active journals take up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".0M on disk.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_2-2-设置日志占用的空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置日志占用的空间"}},[s._v("#")]),s._v(" 2.2 设置日志占用的空间")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl --vacuum-size"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("500M\nVacuuming done, freed 0B of archived journals on disk.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_2-3-设置日志保存的时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-设置日志保存的时间"}},[s._v("#")]),s._v(" 2.3 设置日志保存的时间")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ journalctl --vacuum-time"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1month\nVacuuming done, freed 0B of archived journals on disk.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_3-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[s._v("#")]),s._v(" 3. 配置")]),s._v(" "),e("p",[s._v("上面的一些维护动作，也可以通过配置参数设置，配置文件位于/etc/systemd/journald.conf。")]),s._v(" "),e("ul",[e("li",[s._v("Storage=persistent")]),s._v(" "),e("li",[s._v("Compress=yes")]),s._v(" "),e("li",[s._v("Seal=yes")]),s._v(" "),e("li",[s._v("SplitMode=uid")]),s._v(" "),e("li",[s._v("SyncIntervalSec=5m")]),s._v(" "),e("li",[s._v("RateLimitInterval=30s")]),s._v(" "),e("li",[s._v("RateLimitBurst=1000")]),s._v(" "),e("li",[s._v("SystemMaxUse=")]),s._v(" "),e("li",[s._v("SystemKeepFree=")]),s._v(" "),e("li",[s._v("SystemMaxFileSize=")]),s._v(" "),e("li",[s._v("RuntimeMaxUse=")]),s._v(" "),e("li",[s._v("RuntimeKeepFree=")]),s._v(" "),e("li",[s._v("RuntimeMaxFileSize=")]),s._v(" "),e("li",[s._v("MaxRetentionSec=")]),s._v(" "),e("li",[s._v("MaxFileSec=1month")]),s._v(" "),e("li",[s._v("ForwardToSyslog=yes")]),s._v(" "),e("li",[s._v("ForwardToKMsg=no")]),s._v(" "),e("li",[s._v("ForwardToConsole=no")]),s._v(" "),e("li",[s._v("ForwardToWall=yes")]),s._v(" "),e("li",[s._v("TTYPath=/dev/console")]),s._v(" "),e("li",[s._v("MaxLevelStore=debug")]),s._v(" "),e("li",[s._v("MaxLevelSyslog=debug")]),s._v(" "),e("li",[s._v("MaxLevelKMsg=notice")]),s._v(" "),e("li",[s._v("MaxLevelConsole=info")]),s._v(" "),e("li",[s._v("MaxLevelWall=emerg")])])])}),[],!1,null,null,null);a.default=r.exports}}]);