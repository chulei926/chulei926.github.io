(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{493:function(s,a,t){"use strict";t.r(a);var n=t(22),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"磁盘常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#磁盘常用命令"}},[s._v("#")]),s._v(" 磁盘常用命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看各个文件占用大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" -sh *\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"iotop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iotop"}},[s._v("#")]),s._v(" iotop")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 安装")]),s._v("\n$ yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iotop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 只显示正在产生I/O的进程或线程。除了传参，可以在运行过程中按o生效")]),s._v("\n$ iotop  -o\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 时间刷新间隔2秒，输出5次")]),s._v("\n$ iotop  -d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 非交互式，输出5次，间隔2秒，输出到屏幕，也可输出到日志文本，用于监控某时间段的io信息")]),s._v("\n$ iotop -botq -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 非交互式，输出pid为8382的进程信息")]),s._v("\n$ iotop -botq -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8382")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"lsof"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lsof"}},[s._v("#")]),s._v(" lsof")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 安装")]),s._v("\n$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("hr"),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"磁盘使用率高-排查过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#磁盘使用率高-排查过程"}},[s._v("#")]),s._v(" 磁盘使用率高 排查过程")]),s._v(" "),t("h3",{attrs:{id:"_1-df-h-查看磁盘空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-df-h-查看磁盘空间"}},[s._v("#")]),s._v(" 1. df -h 查看磁盘空间")]),s._v(" "),t("p",[s._v("40G的系统盘 使用了 31G，而其他机器只使用了10G左右。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        40G   31G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".5G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("% /\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-du-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-du-sh"}},[s._v("#")]),s._v(" 2. du -sh *")]),s._v(" "),t("p",[s._v("并未发现可优化空间。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" -sh * \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-lsof-grep-deleted"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-lsof-grep-deleted"}},[s._v("#")]),s._v(" 3. lsof |grep deleted")]),s._v(" "),t("p",[s._v("查看已删除但是并未释放空间的进程。"),t("br"),s._v("\n有很多是deleted的状态的文件，这些文件实际上还是被程序占用了，导致磁盘的空间没有释放掉，处理的办法是重启一下应用或者重启服务器即可。"),t("br"),s._v("\n生产环境服务器哪能随便重启，只能重启服务。"),t("br")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" deleted\n\nDBENGINE  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31641")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32273")]),s._v("       netdata  998u      REG              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("995328")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("711655")]),s._v(" /opt/netdata/var/cache/netdata/dbengine/journalfile-1-0000003609.njf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDBENGINE  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31641")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32273")]),s._v("       netdata  999u      REG              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16789504")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("711656")]),s._v(" /opt/netdata/var/cache/netdata/dbengine/datafile-1-0000003610.ndf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDBENGINE  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31641")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32273")]),s._v("       netdata 1000u      REG              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("978944")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("711657")]),s._v(" /opt/netdata/var/cache/netdata/dbengine/journalfile-1-0000003610.njf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDBENGINE  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31641")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32273")]),s._v("       netdata 1001u      REG              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16814080")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("711658")]),s._v(" /opt/netdata/var/cache/netdata/dbengine/datafile-1-0000003611.ndf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n。。。。。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("可以看到全是 PID=31641 的 netdata 进程 。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 关闭 netdata")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" netdata\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启动 netdata")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" netdata start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("此时再使用 df -h 查看，磁盘释放很彻底，开心。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Filesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        40G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".7G   32G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("% /\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);